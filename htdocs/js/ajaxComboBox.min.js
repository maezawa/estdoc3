(function(p){function y(c){c=p(c);return!(!c.width()&&!c.height())&&"none"!==c.css("display")}function t(c,s){c=c.replace(/=#\]/g,'="#"]');var e,f,n=z.exec(c);n&&n[2]in w&&(e=w[n[2]],f=n[3],c=n[1],f&&(n=Number(f),f=isNaN(n)?f.replace(/^["']|["']$/g,""):n));return s(c,e,f)}var q=p.zepto,A=q.qsa,x=q.matches,w=p.expr[":"]={visible:function(){if(y(this))return this},hidden:function(){if(!y(this))return this},selected:function(){if(this.selected)return this},checked:function(){if(this.checked)return this},parent:function(){return this.parentNode},first:function(c){if(0===c)return this},last:function(c,s){if(c===s.length-1)return this},eq:function(c,s,e){if(c===e)return this},contains:function(c,s,e){if(-1<p(this).text().indexOf(e))return this},has:function(c,s,e){if(q.qsa(this,e).length)return this}},z=/(.*):(\w+)(?:\(([^)]+)\))?$\s*/,B=/^\s*>/,u="Zepto"+ +new Date;q.qsa=function(c,s){return t(s,function(e,f,n){try{var k;!e&&f?e="*":B.test(e)&&(k=p(c).addClass(u),e="."+u+" "+e);var g=A(c,e)}catch(d){throw console.error("error performing selector: %o",s),d;}finally{k&&k.removeClass(u)}return f?q.uniq(p.map(g,function(b,h){return f.call(b,h,g,n)})):g})};q.matches=function(c,s){return t(s,function(e,f,n){return(!e||x(c,e))&&(!f||f.call(c,null,n)===c)})}})(Zepto);
(function(){function p(p,t,q){function A(){$(b.results).children("li").on("mouseover",function(){$(b.results).children("li").removeClass(g.select);$(this).addClass(g.select);w()}).on("mousedown",function(h){h.preventDefault();h.stopPropagation();a:{h=n();var a=$(b.container).offset().top,c;d.size_li=$(b.results).children("li:first").height;c=d.size_li;var r=document.documentElement.clientHeight,m=0<document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop,g=m+r-c,e;if($(h).length)if(a<m||c>r)e=a-m;else if(a>g)e=a-g;else break a;else a<m&&(e=a-m);window.scrollBy(0,e)}if(e=n())$(b.combo_input).val($(e).text()),b.id=$(b.hidden).attr("id"),$("#"+b.id).val($(e).attr("pkey")),d.prev_value=$(b.combo_input).val(),f();k.bind_to&&$(b.combo_input).trigger(k.bind_to,!1);$(b.combo_input).focus();$(b.combo_input).change();x()})}function x(){$(b.results).addClass(g.re_off);$(b.combo_input).removeClass(g.input_off)}function w(){$(b.results).removeClass(g.re_off);$(b.combo_input).addClass(g.input_off)}function z(){d.timer_valchange=setTimeout(B,500)}function B(){var h=$(b.combo_input).val();h!=d.prev_value&&(d.prev_value=h,$(b.hidden).val(""),d.page_suggest=1,d.is_suggest=!0,$.ajax({url:"http://api.estdoc.jp/geo?callback=?&name="+h,success:function(a,h){k.source=a.body;var r=d.is_suggest?$(b.combo_input).val().replace(/(^\s+)|(\s+$)/g,""):"";if(1>r.length&&d.is_suggest)f();else{r=r.split(/[\s\u3000]+/);u();""==$(b.results).html()&&(e(),$(b.container).addClass(g.container_open));if(d.is_paging){var m=n();d.is_paging=m?$(b.results).children("li").index(m):-1}else d.is_suggest||(d.is_paging=0);m=d.is_suggest?d.page_suggest:d.page_all;"object"==typeof k.source&&c(r,m)}},error:function(a,b,h){console.log(b)}}));$(b.result_area).css("border","1px solid #79b");z()}function u(){d.xhr&&(d.xhr.abort(),d.xhr=!1)}function c(h,a){function c(a,b){return a[k.order_by[0][0]].localeCompare(b[k.order_by[0][0]])}function r(a,b){return b[k.order_by[0][0]].localeCompare(a[k.order_by[0][0]])}var m=[],d=[],f=[],v={},l=0,n=[];do d[l]=h[l].replace(/\W/g,"\\$&").toString(),n[l]=RegExp(d[l],"gi"),l++;while(l<h.length);for(l=0;l<k.source.length;l++){for(var p=!1,q=0,t=n.length;q<t;q++)if(k.source[l][k.field].match(n[q])){if(p=!0,"OR"==k.and_or)break}else if(p=!1,"AND"==k.and_or)break;p&&m.push(k.source[l])}if(void 0==m.length)$(b.results).empty(),e(),$(b.container).addClass(g.container_open),x();else{v.cnt_whole=m.length;for(var n=RegExp("^"+d[0]+"$","gi"),d=RegExp("^"+d[0],"gi"),p=[],q=[],u=[],l=0,t=m.length;l<t;l++)m[l][k.order_by[0][0]].match(n)?p.push(m[l]):m[l][k.order_by[0][0]].match(d)?q.push(m[l]):u.push(m[l]);k.order_by[0][1].match(/^asc$/i)?(p.sort(c),q.sort(c),u.sort(c)):(p.sort(r),q.sort(r),u.sort(r));f=f.concat(p).concat(q).concat(u);l=(a-1)*k.per_page;m=l+k.per_page;for(t=0;l<m&&void 0!=f[l];l++,t++)for(var w in f[l])w==k.primary_key&&(void 0==v.primary_key&&(v.primary_key=[]),v.primary_key.push(f[l][w])),w==k.field&&(void 0==v.candidate&&(v.candidate=[]),v.candidate.push(f[l][w]));v.cnt_page="undefined"===typeof v.candidate?0:v.candidate.length;s(v,h,a)}}function s(h,a,c){h.primary_key||(h.primary_key=!1);a=h.candidate;h=h.primary_key;$(b.results).empty();c="undefined"===typeof a?0:a.length;for(var r=0;r<c;r++){var m=$("<li>").text(a[r]).attr({pkey:h[r],title:a[r]});$(b.results).append(m)}e();$(b.container).addClass(g.container_open);A();!1===d.is_paging?x():(a=d.is_paging,h=$(b.results).children("li").length-1,a>h&&(a=h),a=$(b.results).children("li").eq(a),$(a).addClass(g.select),d.is_paging=!1,w())}function e(){var h=$(b.combo_input).parent().offset(),a=$(b.combo_input).offset();$(b.result_area).css({top:a.top+$(b.combo_input).height+"px",left:a.left-h.left+"px"});$(b.result_area).show()}function f(){x();$(b.results).empty();$(b.result_area).hide();$(b.container).removeClass(g.container_open);u()}function n(){if($(b.result_area).is(":hidden"))return!1;var h=$(b.results).children("li."+g.select);return $(h).length?h:!1}var k=function(b,a){a=$.extend({source:b,field:"name",and_or:"AND",per_page:10,navi_num:5,primary_key:"id",bind_to:!1,navi_simple:!1},a);a.search_field=void 0==a.search_field?a.field:a.search_field;a.and_or=a.and_or.toUpperCase();for(var c=["search_field"],d=0,e=c.length;d<e;d++)a[c[d]]=a[c[d]].replace(/[\s\u3000]+/g,"").split(",");a.order_by=void 0==a.order_by?a.search_field:a.order_by;var c=a,d=a.order_by,g=a.field,e=[];if("object"==typeof d)for(var g=0,k=d.length;g<k;g++){var f=d[g].replace(/(^\s+)|(\s+$)/g,"").split(" ");e[g]=2==f.length?f:[f[0],"ASC"]}else f=d.replace(/(^\s+)|(\s+$)/g,"").split(" "),e[0]=2==f.length?f:f[0].match(/^(ASC|DESC)$/i)?[g,f[0]]:[f[0],"ASC"];c.order_by=e;return a}(t,q),g=function(){var b={container:"ac_container",container_open:"ac_container_open",selected:"ac_selected",re_area:"ac_result_area",results:"ac_results",re_off:"ac_results_off",select:"ac_over",input_off:"ac_input_off"};return b=$.extend(b,{input:"ac_s_input"})}(),d={timer_valchange:!1,is_suggest:!1,page_all:1,page_suggest:1,max_all:1,max_suggest:1,is_paging:!1,is_loading:!1,xhr:!1,prev_value:""},b=function(b){var a={};a.combo_input=$(b).attr("autocomplete","off").addClass(g.input);a.container=$(a.combo_input);a.result_area=$("<div>").addClass(g.re_area);a.results=$('<ul id="'+g.results+'_">').addClass(g.results);g.Id=g.results+"_";b=$(a.combo_input).attr("id");a.hidden=$('<input type="hidden" />').attr({name:b,id:b+"_"}).val("");$(a.result_area).insertAfter($(a.container));!$(a.hidden)&&$(a.hidden).insertAfter($(a.result_area));$(a.result_area).append(a.results);return a}(p);(function(){$(b.combo_input).focus(z).on("click",function(){x();$(b.results).children("li").removeClass(g.select)})})();(function(){var c=!1;$(b.container).on("mousedown",function(a){c=!0});$("html").on("mousedown",function(){var a=$(b.results).children("li")[0];"undefined"!=typeof a&&$(b.hidden).val($(a).attr("pkey"));c?c=!1:f()})})();return!0}$.fn.ajaxComboBox=function(y,t){return this.each(function(){p(this,y,t)})}})($);